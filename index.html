<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>WGSL Game Engine</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background: #000;
        font-family: monospace;
        color: #fff;
      }
      a {
        color: inherit;
      }
      #container {
        text-align: center;
      }
      canvas {
        border: 2px solid #333;
        image-rendering: pixelated;
        image-rendering: crisp-edges;
        max-height: calc(100vh - 5.5em);
      }
      #error {
        color: #f66;
        margin-top: 20px;
        white-space: pre-wrap;
        text-align: left;
        max-width: 800px;
      }
      #info {
        margin-top: 10px;
        color: #999;
        font-size: 12px;
      }
      #title {
        margin-bottom: 5px;
      }
    </style>
    <script type="importmap">
      {
        "imports": {
          "fflate": "https://esm.sh/fflate/esm/browser.js"
        }
      }
    </script>
  </head>
  <body>
    <div id="container">
      <div id="title">Loading...</div>
      <canvas id="canvas"></canvas>
      <div id="info"></div>
      <div id="error"></div>
    </div>
    <script type="module">
      import { createGame } from "./wgsleng.js";

      const canvas = document.getElementById("canvas");
      const titleEl = document.getElementById("title");
      const infoEl = document.getElementById("info");
      const errorEl = document.getElementById("error");

      // Error handler
      function handleError(msg) {
        errorEl.textContent = msg;
      }

      window.addEventListener("hashchange", () => {
        // reload is required to clear it out
        document.location.reload();
      });

      // allow url-hash to set cart
      const cart = document.location.hash
        ? decodeURIComponent(document.location.hash.slice(1))
        : "examples/bob/main.wgsl"; // you can also do zip files

      const game = await createGame(cart, canvas, handleError);
      window.engine = game.engine; // Expose for debugging

      document.title = game.title;
      titleEl.textContent = game.title;
      infoEl.innerHTML = `Controls: Arrows for DPAD, X/Z/S/A/Q/W/Shift/Enter for A/B/X/Y/L/R/SELECT/START<br/>You can <a href="${cart}">view source</a><br />Made with <a href="https://github.com/notnullgames/wgsleng">wgsleng</a>`;

      console.log(game);
    </script>
  </body>
</html>
